import{_ as e,L as a,s as t,H as l,y as o,n as i,o as n,c as u,w as d,i as r,a as s,b as c,d as p,t as m,f,g as h,p as _,N as y,q as b,G as v}from"./index-1840daf0.js";import{_ as D}from"./uni-data-select.cd3809bc.js";import{_ as g}from"./uni-forms-item.9c81628b.js";import{_ as x}from"./uni-data-checkbox.33666354.js";import{_ as A}from"./uni-easyinput.d81ce094.js";import{_ as L}from"./uni-link.819b12c3.js";import{_ as V}from"./uni-forms.506a0a8f.js";import"./uni-load-more.bb58fed9.js";const k={platform:{rules:[{required:!0}],label:"目标平台"},audience_type:{rules:[{required:!0},{format:"string"},{validateFunction:function(e,a,t,l){if("ALL"!=t.audience_type&&!t.audience_value){return l({ALL:"所有用户",user_id:"用户ID",custom_tag:"用户标签",cid:"推送设备标识"}[t.audience_type]+"不能为空"),!1}}},{range:[{text:"所有用户",value:"ALL"},{text:"用户ID",value:"user_id"},{text:"用户标签",value:"custom_tag"},{text:"推送设备标识",value:"cid"}]}],label:"目标用户"},audience_value:{rules:[{required:!1},{format:"string"},{maxLength:99}]},url:{rules:[{required:!0},{format:"url"}],label:"url链接，华为平台必须使用https"},title:{rules:[{format:"string"},{required:!0},{maxLength:32}],label:"标题"},content:{rules:[{required:!0},{format:"string"},{maxLength:32}],label:"副标题"},click_type:{rules:[{required:!0},{format:"string"},{range:[{text:"透传参数并唤醒APP",value:"intent"},{text:"使用浏览器打开链接",value:"open_url"}]}],label:"点击通知后"},payload:{rules:[{required:!0},{format:"string"},{validateFunction:function(e,a,t,l){console.log(a),a||l("非APP端，透传内容不能为空")}}],label:"透传内容"},badge:{rules:[{format:"number"}],label:"角标"},channel:{rules:[{format:"string"}],label:"消息渠道channel_id"},sound:{rules:[{format:"string"}],label:"铃声设置"},"content-available":{rules:[{format:"bool"}],label:"是否为静默消息（仅ios有效）"},force_notification:{rules:[{format:"bool"}],label:"强制通知栏消息"}},q=a.importObject("uni-push-co");function w(e){let a={};for(let t in k)e.indexOf(t)>-1&&(a[t]=k[t]);return a}const O=e({computed:{audience_tip(){let e=this.formData.audience_value||"",a=e?e.split("\n").length:0;switch(this.formData.audience_type){case"user_id":return{placeholder:"请输入uni-id-users表对应的用户_id",msg:`多个值可按“回车键”换行分隔，当前已输入${a}个`};case"user_tag":return{placeholder:"请输入uni-id-tag表对应的nane值",msg:`多个值可按“回车键”换行分隔，当前已输入${a}个`};case"device_id":return{placeholder:"请输入uni-id-device表对应的device_id的值",msg:`多个值可按“回车键”换行分隔，当前已输入${a}个`};case"push_clientid":return{placeholder:"请输入uni-id-device表对应的设备推送标识push_clientid的值",msg:`多个值可按“回车键”换行分隔，当前已输入${a}个`};case"getui_custom_tag":return{placeholder:"请输入通过uni-cloud-push的设置push客户端标签",msg:"仅限支持输入1个自定义push客户端标签"};case"jql":return{placeholder:"请输入查询uni-id-user表的jql查询表达式",msg:""};default:return{placeholder:"",msg:""}}},platformHasApp(){let{platform:e}=this.formData;return"ALL"==e||e.includes("app-android")||e.includes("app-ios")},platformHasWithoutApp(){let{platform:e}=this.formData;return"ALL"==e||0!=e.filter((e=>-1==e.indexOf("app-"))).length},onlyIos(){return 1==this.formData.platform.length&&this.formData.platform.includes("app-ios")}},data(){let e={platform:"ALL",audience_type:"ALL",audience_value:"",title:"",content:"",open_url:"",payload:"",badge:"+1",sound:"",content_available:!1,force_notification:!1,appId:"",options:""};return{platform:"ALL",formData:e,formOptions:{platform:[{text:"网页端",value:"web"},{text:"App-iOS",value:"app-ios"},{text:"App-Android",value:"app-android"},{text:"微信小程序",value:"mp-weixin"},{text:"360小程序",value:"mp-360"},{text:"百度小程序",value:"mp-baidu"},{text:"支付宝小程序",value:"mp-alipay"},{text:"字节跳动小程序",value:"mp-toutiao"},{text:"QQ小程序",value:"mp-qq"},{text:"快应用联盟",value:"quickapp-webview-union"},{text:"快应用华为",value:"quickapp-webview-huawei"},{text:"快手小程序",value:"mp-kuaishou"},{text:"飞书小程序",value:"mp-lark"},{text:"京东小程序",value:"mp-jd"}],setPlatform:[{text:"所有平台",value:"ALL"},{text:"指定平台",value:"custom"}],setAudienceType:[{text:"所有设备",value:"ALL"},{text:"指定设备",value:"custom"}],audience_type:[{text:"用户id",value:"user_id"},{text:"用户标签",value:"user_tag"},{text:"设备id",value:"device_id"},{text:"个推客户端id",value:"push_clientid"},{text:"个推自定义客户端标签",value:"getui_custom_tag"}],clickNotificationAction:[{text:"打开应用并透传消息",value:0},{text:"启动系统浏览器打开链接（仅Android支持）",value:1,disable:!0}]},rules:{...w(Object.keys(e))},clickNotificationAction:0,payload_tip:'建议用json格式,如:{"user_id":"xxx","content":"xxx"}\n可以通过uni.onPushMessage接收;接收。长度 ≤ 3072',channel:{hw:null,xm:null,vivo:null,oppo:null}}},onReady(){this.$refs.form.setRules(this.rules)},watch:{"formData.audience_type":{handler(e){this.formData.audience_value="",["device_id","push_clientid","getui_custom_tag"].includes(e)&&(this.platform="ALL",this.formData.platform="ALL")}},"formData.platform":{handler(e){e.includes("app-android")&&1==e.length?this.formOptions.clickNotificationAction[1].disable=!1:(this.clickNotificationAction=0,this.formOptions.clickNotificationAction[1].disable=!0)}}},methods:{setData(e,a){this.formData[e]=a},setPlatform(e){"ALL"==e.detail.value?this.formData.platform="ALL":this.formData.platform=["web"]},setAudienceType(e){"ALL"==e.detail.value?this.formData.audience_type="ALL":this.formData.audience_type="user_id"},async submit(){let e={...this.formData};if(k.payload.rules[0].required=this.platformHasWithoutApp,this.formData.options){try{if("object"!=typeof JSON.parse(this.formData.options))return t({title:"扩展字段必须为json格式",icon:"none"})}catch(n){return t({title:"扩展字段必须为json格式",icon:"none"})}e.options=JSON.parse(this.formData.options)}if("ALL"!=e.audience_type&&!e.audience_value)return t({title:e.audience_type+"的值不能为空",icon:"none"});l(),this.$refs.form.validate().then((async t=>{let l={...e};if(l.channel=this.channel,"ALL"!=e.audience_type&&(["user_id","device_id","push_clientid","getui_custom_tag"].includes(e.audience_type)?l[e.audience_type]=e.audience_value.split("\n"):l[e.audience_type]=e.audience_value),l.content_available=l.content_available?1:0,l.payload)try{l.payload=JSON.parse(l.payload)}catch(r){console.log(r)}delete l.audience_type,delete l.audience_value,console.log("data",l);let n=await q.sendMessage(l);console.log({res:n}),n.errMsg;const u=n.data.taskid||Object.keys(n.data)[0],d=a.database();n=await d.collection("uni-push-log").add({taskid:u,...e}),o({content:"推送成功，任务id:"+u,confirmText:"查看推送情况",success:e=>{e.confirm&&i({url:"/uni_modules/uni-push-admin/pages/log/list"})}})}))},showContentAvailableTip(){o({content:"iOS设备当应用切到后台时收到push消息，默认以通知栏消息提醒用户。你可以通过开启静默消息来关闭该行为。苹果官方建议1小时最多推送3条静默消息",confirmText:"知道了",showCancel:!1})},showForceNotificationTip(){o({content:"无论是离线推送还是在线推送，都会自创建通知栏消息。HBuilderX 3.5.2 及其以上版本的客户端支持\t",confirmText:"知道了",showCancel:!1})}}},[["render",function(e,a,t,l,o,i){const k=f(h("uni-data-select"),D),q=f(h("uni-forms-item"),g),w=f(h("uni-data-checkbox"),x),O=r,C=f(h("uni-easyinput"),A),U=_,j=f(h("uni-link"),L),N=f(h("uni-icons"),v),P=y,H=b,I=f(h("uni-forms"),V);return n(),u(O,{class:"uni-container"},{default:d((()=>[s(I,{ref:"form",value:o.formData,"validate-trigger":"submit","err-show-type":"toast",id:"from"},{default:d((()=>[s(q,{name:"appId",label:"选择应用",required:""},{default:d((()=>[s(k,{collection:"opendb-app-list",field:"appid as value, name as text",orderby:"text asc",defItem:1,modelValue:o.formData.appId,"onUpdate:modelValue":a[0]||(a[0]=e=>o.formData.appId=e),clear:!1},null,8,["modelValue"])])),_:1}),s(q,{name:"platform",label:"目标平台",required:""},{default:d((()=>[s(w,{ref:"platform",disabled:["device_id","push_clientid","getui_custom_tag"].includes(o.formData.audience_type),onChange:i.setPlatform,modelValue:o.platform,"onUpdate:modelValue":a[1]||(a[1]=e=>o.platform=e),localdata:o.formOptions.setPlatform},null,8,["disabled","onChange","modelValue","localdata"])])),_:1}),"ALL"!=o.formData.platform?(n(),u(O,{key:0,id:"platform-value-box"},{default:d((()=>[s(w,{disabled:["device_id","push_clientid","getui_custom_tag"].includes(o.formData.audience_type),multiple:!0,min:1,modelValue:o.formData.platform,"onUpdate:modelValue":a[2]||(a[2]=e=>o.formData.platform=e),localdata:o.formOptions.platform},null,8,["disabled","modelValue","localdata"])])),_:1})):c("",!0),s(q,{name:"platform",label:"发送目标",required:""},{default:d((()=>[s(w,{onChange:i.setAudienceType,value:"ALL",localdata:o.formOptions.setAudienceType},null,8,["onChange","localdata"])])),_:1}),"ALL"!=o.formData.audience_type?(n(),u(O,{key:1,id:"audience-value-box"},{default:d((()=>[s(w,{modelValue:o.formData.audience_type,"onUpdate:modelValue":a[3]||(a[3]=e=>o.formData.audience_type=e),localdata:o.formOptions.audience_type},null,8,["modelValue","localdata"]),s(q,{name:"audience_value"},{default:d((()=>[s(C,{type:["getui_custom_tag","jql"].includes(o.formData.audience_type)?"text":"textarea",autoHeight:"",id:"audience-value",placeholder:i.audience_tip.placeholder,modelValue:o.formData.audience_value,"onUpdate:modelValue":a[4]||(a[4]=e=>o.formData.audience_value=e)},null,8,["type","placeholder","modelValue"])])),_:1}),s(U,{style:{"font-size":"12px",color:"#bbb"}},{default:d((()=>[p(m(i.audience_tip.msg),1)])),_:1}),"push_clientid"==o.formData.audience_type?(n(),u(O,{key:0,class:"audience-tip"},{default:d((()=>[s(U,null,{default:d((()=>[p("发送目标基于“")])),_:1}),s(j,{href:"https://uniapp.dcloud.net.cn/uniCloud/uni-cloud-push/api.html#getpushclientid",text:"个推客户端id",color:"#2979ff",fontSize:"12"}),s(U,null,{default:d((()=>[p("”，不能限制目标平台")])),_:1})])),_:1})):c("",!0),"getui_custom_tag"==o.formData.audience_type?(n(),u(O,{key:1,class:"audience-tip"},{default:d((()=>[s(U,null,{default:d((()=>[p("发送目标基于“")])),_:1}),s(j,{href:"https://uniapp.dcloud.net.cn/uniCloud/uni-cloud-push/api.html#%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%A0%87%E7%AD%BE",text:"个推自定义客户端标签",color:"#2979ff",fontSize:"12"}),s(U,null,{default:d((()=>[p("”，不能限制目标平台")])),_:1})])),_:1})):c("",!0),"device_id"==o.formData.audience_type?(n(),u(O,{key:2,class:"audience-tip"},{default:d((()=>[s(U,null,{default:d((()=>[p("发送目标基于设备ID时，不能限制目标平台")])),_:1})])),_:1})):c("",!0)])),_:1})):c("",!0),s(q,{label:"通知栏点击行为",required:""},{default:d((()=>[s(w,{modelValue:o.clickNotificationAction,"onUpdate:modelValue":a[5]||(a[5]=e=>o.clickNotificationAction=e),localdata:o.formOptions.clickNotificationAction},null,8,["modelValue","localdata"])])),_:1}),i.platformHasApp?(n(),u(q,{key:2,name:"force_notification",label:"强制通知栏消息"},{default:d((()=>[s(O,{class:"force-notification-tip"},{default:d((()=>[s(N,{type:"help-filled",size:"16",color:"#DDD",onClick:i.showForceNotificationTip},null,8,["onClick"])])),_:1}),s(P,{onChange:a[6]||(a[6]=e=>i.setData("force_notification",e.detail.value)),disabled:!i.platformHasApp,checked:o.formData.force_notification},null,8,["disabled","checked"]),s(U,{style:{color:"#666666"}},{default:d((()=>[p("(仅App端有效)")])),_:1})])),_:1})):c("",!0),this.clickNotificationAction?(n(),u(q,{key:"open_url",name:"open_url",label:"URL链接",required:""},{default:d((()=>[s(C,{type:"text",modelValue:o.formData.open_url,"onUpdate:modelValue":a[7]||(a[7]=e=>o.formData.open_url=e),placeholder:"以http(s)://开头的有效可访问链接"},null,8,["modelValue"])])),_:1})):(n(),u(q,{key:"payload",name:"payload",label:"透传内容",required:this.platformHasWithoutApp},{default:d((()=>[s(j,{class:"payload-help",href:"https://uniapp.dcloud.io/unipush-v2.html#listener",showUnderLine:!1},{default:d((()=>[s(N,{type:"help-filled",size:"16",color:"#DDD"})])),_:1}),s(C,{type:"textarea",maxlength:"3072",placeholder:o.payload_tip,modelValue:o.formData.payload,"onUpdate:modelValue":a[8]||(a[8]=e=>o.formData.payload=e),trim:"both"},null,8,["placeholder","modelValue"])])),_:1},8,["required"])),i.platformHasApp?(n(),u(O,{key:5},{default:d((()=>[s(q,{name:"title",label:"APP通知栏标题",required:""},{default:d((()=>[s(C,{placeholder:"应用离线时,显示在通知栏的标题,长度小于20字",modelValue:o.formData.title,"onUpdate:modelValue":a[9]||(a[9]=e=>o.formData.title=e),trim:"both"},null,8,["modelValue"])])),_:1}),s(q,{name:"content",label:"APP通知栏内容",required:""},{default:d((()=>[s(C,{placeholder:"应用离线时,显示在通知栏的内容,长度小于50字",modelValue:o.formData.content,"onUpdate:modelValue":a[10]||(a[10]=e=>o.formData.content=e),trim:"both"},null,8,["modelValue"])])),_:1}),"ALL"==o.formData.platform||o.formData.platform.includes("app-android")?(n(),u(q,{key:0,name:"channel",class:"channel-box",label:"渠道_id"},{default:d((()=>[s(j,{class:"channel-help",href:"https://uniapp.dcloud.io/uniCloud/uni-cloud-push/api.html#channel",showUnderLine:!1},{default:d((()=>[s(N,{type:"help-filled",size:"16",color:"#DDD"})])),_:1}),s(O,{class:"channel-input-box"},{default:d((()=>[s(C,{placeholder:"华为渠道_id",modelValue:o.channel.HW,"onUpdate:modelValue":a[11]||(a[11]=e=>o.channel.HW=e),trim:"both"},null,8,["modelValue"]),s(C,{placeholder:"小米渠道_id",modelValue:o.channel.XM,"onUpdate:modelValue":a[12]||(a[12]=e=>o.channel.XM=e),trim:"both"},null,8,["modelValue"]),s(C,{placeholder:"vivo渠道_id",modelValue:o.channel.VO,"onUpdate:modelValue":a[13]||(a[13]=e=>o.channel.VO=e),trim:"both"},null,8,["modelValue"]),s(C,{placeholder:"oppo渠道_id",modelValue:o.channel.OP,"onUpdate:modelValue":a[14]||(a[14]=e=>o.channel.OP=e),trim:"both"},null,8,["modelValue"])])),_:1})])),_:1})):c("",!0),s(q,{name:"sound",label:"自定义push铃声"},{default:d((()=>[s(j,{class:"sound-help",href:"https://uniapp.dcloud.io/uniCloud/uni-cloud-push/api.html#sound",showUnderLine:!1},{default:d((()=>[s(N,{type:"help-filled",size:"16",color:"#DDD"})])),_:1}),s(C,{placeholder:"填写文件名,不含扩展名；如：pushsound.caf填写pushsound即可。不填或铃声文件未找到，响铃为系统默认铃声。",modelValue:o.formData.sound,"onUpdate:modelValue":a[15]||(a[15]=e=>o.formData.sound=e)},null,8,["modelValue"])])),_:1}),i.platformHasApp?(n(),u(q,{key:1,name:"content_available",label:"静默消息"},{default:d((()=>[s(O,{class:"content-available-tip"},{default:d((()=>[s(N,{type:"help-filled",size:"16",color:"#DDD",onClick:i.showContentAvailableTip},null,8,["onClick"])])),_:1}),s(P,{onChange:a[16]||(a[16]=e=>i.setData("content_available",e.detail.value)),checked:o.formData.content_available,disabled:!i.onlyIos},null,8,["checked","disabled"]),s(U,{style:{color:"#666666"}},{default:d((()=>[p("(仅选择iOS平台时有效)")])),_:1})])),_:1})):c("",!0),s(q,{label:"扩展字段"},{default:d((()=>[s(j,{class:"options-help",href:"https://uniapp.dcloud.io/uniCloud/uni-cloud-push/options.html",showUnderLine:!1},{default:d((()=>[s(N,{type:"help-filled",size:"16",color:"#DDD"})])),_:1}),s(C,{type:"textarea",maxlength:"3072",placeholder:"JSON格式，用于厂商消息拓展",modelValue:o.formData.options,"onUpdate:modelValue":a[17]||(a[17]=e=>o.formData.options=e),trim:"both"},null,8,["modelValue"])])),_:1})])),_:1})):c("",!0),s(O,{class:"uni-button-group"},{default:d((()=>[s(H,{type:"primary",class:"uni-button",onClick:i.submit},{default:d((()=>[p("提交")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["value"])])),_:1})}],["__scopeId","data-v-4ae7a37d"]]);export{O as default};
